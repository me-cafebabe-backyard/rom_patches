From 3628b4841c78daa2f762ff6566cfc486b6da6350 Mon Sep 17 00:00:00 2001
From: Android Build Server <build@AndroidBuild>
Date: Thu, 5 Oct 2023 08:03:50 +0000
Subject: [PATCH] - isolated_compute_app

---
 legacy/vendor/common/domain.te           | 16 ++++++++--------
 legacy/vendor/common/hal_drm_clearkey.te |  2 +-
 legacy/vendor/common/hal_drm_widevine.te |  2 +-
 3 files changed, 10 insertions(+), 10 deletions(-)

diff --git a/legacy/vendor/common/domain.te b/legacy/vendor/common/domain.te
index 1475a304..8f30c1c5 100644
--- a/legacy/vendor/common/domain.te
+++ b/legacy/vendor/common/domain.te
@@ -25,10 +25,10 @@
 # OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN
 # IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 
-r_dir_file({domain - isolated_app - untrusted_app_all }, sysfs_socinfo);
-r_dir_file({domain - isolated_app - untrusted_app_all }, sysfs_soc);
-r_dir_file({domain - isolated_app - untrusted_app_all }, sysfs_esoc);
-r_dir_file({domain - isolated_app - untrusted_app_all }, sysfs_ssr);
+r_dir_file({domain - isolated_app - isolated_compute_app - untrusted_app_all }, sysfs_socinfo);
+r_dir_file({domain - isolated_app - isolated_compute_app - untrusted_app_all }, sysfs_soc);
+r_dir_file({domain - isolated_app - isolated_compute_app - untrusted_app_all }, sysfs_esoc);
+r_dir_file({domain - isolated_app - isolated_compute_app - untrusted_app_all }, sysfs_ssr);
 
 #Reding of standard chip details need this
 allow untrusted_app_all {
@@ -37,12 +37,12 @@ allow untrusted_app_all {
         sysfs_esoc
         sysfs_ssr
         }:dir search;
-r_dir_file({domain - isolated_app }, vendor_sysfs_public);
+r_dir_file({domain - isolated_app - isolated_compute_app }, vendor_sysfs_public);
 
 dontaudit domain kernel:system module_request;
 
 # Allow all domains read access to sysfs_thermal
-r_dir_file({domain - isolated_app}, sysfs_thermal);
+r_dir_file({domain - isolated_app - isolated_compute_app}, sysfs_thermal);
 
 # Allow domain to read /vendor -> /system/vendor
 allow domain system_file:lnk_file getattr;
@@ -81,6 +81,6 @@ no_debugfs_restriction(`
 ')
 
 # allow all context to read sysfs_kgsl
-allow { domain - isolated_app } sysfs_kgsl:dir search;
+allow { domain - isolated_app - isolated_compute_app } sysfs_kgsl:dir search;
 # allow all context to read gpu model
-allow { domain - isolated_app } sysfs_kgsl_gpu_model:file r_file_perms;
+allow { domain - isolated_app - isolated_compute_app } sysfs_kgsl_gpu_model:file r_file_perms;
diff --git a/legacy/vendor/common/hal_drm_clearkey.te b/legacy/vendor/common/hal_drm_clearkey.te
index a8adb1c5..83a3c91b 100644
--- a/legacy/vendor/common/hal_drm_clearkey.te
+++ b/legacy/vendor/common/hal_drm_clearkey.te
@@ -35,4 +35,4 @@ hal_server_domain(hal_drm_clearkey, hal_drm)
 
 vndbinder_use(hal_drm_clearkey);
 
-allow hal_drm_clearkey { appdomain -isolated_app }:fd use;
+allow hal_drm_clearkey { appdomain -isolated_app - isolated_compute_app }:fd use;
diff --git a/legacy/vendor/common/hal_drm_widevine.te b/legacy/vendor/common/hal_drm_widevine.te
index 3d894f98..e501e0c8 100644
--- a/legacy/vendor/common/hal_drm_widevine.te
+++ b/legacy/vendor/common/hal_drm_widevine.te
@@ -33,7 +33,7 @@ type hal_drm_widevine_exec, exec_type, vendor_file_type, file_type;
 init_daemon_domain(hal_drm_widevine)
 
 allow hal_drm_widevine mediacodec:fd use;
-allow hal_drm_widevine { appdomain -isolated_app }:fd use;
+allow hal_drm_widevine { appdomain -isolated_app - isolated_compute_app }:fd use;
 
 # The QTI DRM-HAL implementation uses a vendor-binder service provided
 # by the HWC HAL.
-- 
2.30.2

